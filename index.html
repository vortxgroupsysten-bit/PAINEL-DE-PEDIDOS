<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Administrativo | SysRest</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* --- VARI√ÅVEIS & RESET --- */
        :root {
            --bg-body: #0f111a;
            --bg-sidebar: #161b22;
            --bg-card: #1f242e;
            --primary: #ff9f43;    /* Laranja - Destaque */
            --success: #2ecc71;    /* Verde - Dinheiro/Sucesso */
            --danger: #e74c3c;     /* Vermelho - A√ß√£o Perigosa */
            --info: #3498db;       /* Azul - Informa√ß√£o */
            --text-main: #e6e6e6;
            --text-muted: #8b949e;
            --border: #30363d;
            --shadow: 0 4px 12px rgba(0,0,0,0.25);
            --radius: 12px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; outline: none; font-family: 'Inter', sans-serif; }
        
        body { background-color: var(--bg-body); color: var(--text-main); display: flex; height: 100vh; overflow: hidden; }
        
        /* --- UTILS --- */
        .hidden { display: none !important; }
        .btn { border: none; padding: 10px 16px; border-radius: 6px; cursor: pointer; font-weight: 600; transition: 0.2s; font-size: 0.9rem; }
        .btn:hover { filter: brightness(1.1); transform: translateY(-1px); }
        .btn-primary { background: var(--primary); color: #fff; }
        .btn-success { background: var(--success); color: #fff; }
        .btn-danger { background: var(--danger); color: #fff; }
        .btn-outline { background: transparent; border: 1px solid var(--border); color: var(--text-muted); }
        .btn-outline:hover { border-color: var(--text-main); color: var(--text-main); }

        /* --- SIDEBAR --- */
        .sidebar { width: 260px; background: var(--bg-sidebar); border-right: 1px solid var(--border); display: flex; flex-direction: column; padding: 24px; }
        .logo { font-size: 1.5rem; font-weight: 700; color: var(--primary); margin-bottom: 40px; display: flex; align-items: center; gap: 10px; letter-spacing: -0.5px; }
        
        .nav-item {
            background: transparent; border: none; color: var(--text-muted); padding: 14px; text-align: left;
            font-size: 0.95rem; cursor: pointer; border-radius: 8px; margin-bottom: 8px; display: flex; align-items: center; gap: 12px; transition: 0.2s;
        }
        .nav-item:hover { background: rgba(255,255,255,0.03); color: var(--text-main); }
        .nav-item.active { background: var(--primary); color: #fff; box-shadow: 0 4px 12px rgba(255, 159, 67, 0.2); }

        /* --- CONTE√öDO PRINCIPAL --- */
        .main { flex: 1; padding: 32px; overflow-y: auto; }
        
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 32px; padding-bottom: 16px; border-bottom: 1px solid var(--border); }
        .header h1 { font-size: 1.8rem; font-weight: 600; }
        .header span { color: var(--text-muted); font-size: 0.9rem; }

        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 24px; }
        .empty-msg { grid-column: 1/-1; text-align: center; padding: 60px; border: 2px dashed var(--border); border-radius: var(--radius); color: var(--text-muted); }

        /* --- CARDS (Estilo Geral) --- */
        .card { background: var(--bg-card); border-radius: var(--radius); padding: 20px; border: 1px solid var(--border); box-shadow: var(--shadow); display: flex; flex-direction: column; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Estilo: Ticket Cozinha */
        .ticket { border-top: 4px solid var(--primary); }
        .ticket-header { display: flex; justify-content: space-between; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px dashed var(--border); }
        .ticket-meta { font-size: 1.2rem; font-weight: 700; }
        .ticket-waiter { font-size: 0.85rem; background: rgba(255,255,255,0.05); padding: 4px 8px; border-radius: 4px; color: var(--primary); margin-bottom: 12px; display: inline-block; }
        .ticket-items { list-style: none; margin-bottom: 20px; flex: 1; }
        .ticket-items li { padding: 6px 0; border-bottom: 1px solid rgba(255,255,255,0.05); display: flex; gap: 10px; }
        .qty { color: var(--primary); font-weight: bold; }

        /* Estilo: Card Mesa/Financeiro */
        .card-stat { border-left: 4px solid var(--success); align-items: center; flex-direction: row; justify-content: space-between; }
        .stat-value { font-size: 1.5rem; font-weight: 700; color: var(--success); }
        .stat-label { color: var(--text-muted); font-size: 0.9rem; }
        
        .dashboard-total { background: linear-gradient(135deg, #1f242e 0%, #252b36 100%); padding: 30px; text-align: center; border-radius: var(--radius); border: 1px solid var(--success); margin-bottom: 30px; }

        /* --- MODAL --- */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); backdrop-filter: blur(4px); z-index: 100; display: flex; justify-content: center; align-items: center; }
        .modal { background: var(--bg-card); width: 450px; border-radius: var(--radius); border: 1px solid var(--border); box-shadow: 0 20px 50px rgba(0,0,0,0.5); overflow: hidden; }
        .modal-header { padding: 20px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; background: rgba(255,255,255,0.02); }
        .modal-body { padding: 20px; max-height: 60vh; overflow-y: auto; }
        .modal-footer { padding: 20px; background: rgba(0,0,0,0.2); display: flex; flex-direction: column; gap: 10px; }
        
        .bill-row { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid var(--border); }
        .bill-total { font-size: 1.4rem; font-weight: 700; text-align: right; color: var(--text-main); }
    </style>
</head>
<body>

    <nav class="sidebar">
        <div class="logo">üî• ChefControl</div>
        <button class="nav-item active" onclick="Router.go('kitchen')" id="nav-kitchen">
            üë®‚Äçüç≥ Cozinha
        </button>
        <button class="nav-item" onclick="Router.go('tables')" id="nav-tables">
            üçΩÔ∏è Mesas / Caixa
        </button>
        <button class="nav-item" onclick="Router.go('finance')" id="nav-finance">
            üìà Financeiro
        </button>
    </nav>

    <main class="main">
        
        <section id="view-kitchen">
            <header class="header">
                <h1>Fila de Pedidos</h1>
                <span>Tempo Real</span>
            </header>
            <div id="kitchen-grid" class="grid"></div>
        </section>

        <section id="view-tables" class="hidden">
            <header class="header">
                <h1>Contas Abertas</h1>
                <span>Gest√£o de Mesas Ativas</span>
            </header>
            <div id="tables-grid" class="grid"></div>
        </section>

        <section id="view-finance" class="hidden">
            <header class="header">
                <h1>Relat√≥rio de Vendas</h1>
                <button class="btn btn-outline" onclick="Finance.clear()">Limpar Hoje</button>
            </header>
            
            <div class="dashboard-total">
                <div class="stat-label">Faturamento Total do Dia</div>
                <div style="font-size: 3rem; font-weight: 700; color: var(--success); margin-top: 10px;" id="finance-total">R$ 0,00</div>
            </div>

            <div id="finance-grid" class="grid"></div>
        </section>

    </main>

    <div id="modal" class="modal-overlay hidden">
        <div class="modal">
            <div class="modal-header">
                <h3>Detalhes da Conta</h3>
                <button class="btn btn-outline" style="padding:5px 10px;" onclick="Modal.close()">‚úï</button>
            </div>
            <div class="modal-body" id="modal-content"></div>
            <div class="modal-footer">
                <div class="bill-total" id="modal-total-value">R$ 0,00</div>
                <button class="btn btn-success" style="width:100%" onclick="Modal.pay()">üí∏ Confirmar Pagamento</button>
            </div>
        </div>
    </div>

    <script>
        // --- M√ìDULO DE DADOS ---
        const DB = {
            get: (key) => JSON.parse(localStorage.getItem(key)) || [],
            getObj: (key) => JSON.parse(localStorage.getItem(key)) || {},
            set: (key, val) => localStorage.setItem(key, JSON.stringify(val))
        };

        // --- M√ìDULO DE ROTEAMENTO ---
        const Router = {
            go: (view) => {
                // Esconde todas as sections
                document.querySelectorAll('section').forEach(el => el.classList.add('hidden'));
                document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));

                // Mostra a section alvo
                document.getElementById(`view-${view}`).classList.remove('hidden');
                document.getElementById(`nav-${view}`).classList.add('active');

                // Recarrega dados da view
                if(view === 'kitchen') Kitchen.render();
                if(view === 'tables') Tables.render();
                if(view === 'finance') Finance.render();
            }
        };

        // --- M√ìDULO COZINHA ---
        const Kitchen = {
            render: () => {
                const orders = DB.get('restaurantOrders');
                const container = document.getElementById('kitchen-grid');
                container.innerHTML = '';

                if (orders.length === 0) {
                    container.innerHTML = '<div class="empty-msg">Nenhum pedido pendente na cozinha.</div>';
                    return;
                }

                orders.forEach((order, index) => {
                    const itemsHtml = order.items.map(i => `<li><span class="qty">${i.qty}x</span> ${i.name}</li>`).join('');
                    
                    const html = `
                        <div class="card ticket">
                            <div class="ticket-header">
                                <span class="ticket-meta">Mesa ${order.table}</span>
                                <span style="color:var(--text-muted)">${order.time}</span>
                            </div>
                            <div class="ticket-waiter">üë§ ${order.waiter}</div>
                            <ul class="ticket-items">${itemsHtml}</ul>
                            <button class="btn btn-outline" style="border-color:var(--success); color:var(--success)" onclick="Kitchen.done(${index})">
                                ‚úÖ Marcar Pronto
                            </button>
                        </div>
                    `;
                    container.innerHTML += html;
                });
            },
            done: (index) => {
                const orders = DB.get('restaurantOrders');
                const order = orders[index];

                // 1. Notifica Gar√ßom
                const notifs = DB.get('restaurantNotifications');
                notifs.push({ id: Date.now(), msg: `Pedido da Mesa ${order.table} pronto!`, waiter: order.waiter });
                DB.set('restaurantNotifications', notifs);

                // 2. Adiciona √† Conta da Mesa
                const tabs = DB.getObj('restaurantTabs');
                if (!tabs[order.table]) tabs[order.table] = [];
                // Adiciona itens com etiqueta do gar√ßom
                const taggedItems = order.items.map(i => ({ ...i, waiter: order.waiter }));
                tabs[order.table].push(...taggedItems);
                DB.set('restaurantTabs', tabs);

                // 3. Remove da Cozinha
                orders.splice(index, 1);
                DB.set('restaurantOrders', orders);
                
                Kitchen.render();
            }
        };

        // --- M√ìDULO MESAS ---
        const Tables = {
            render: () => {
                const tabs = DB.getObj('restaurantTabs');
                const container = document.getElementById('tables-grid');
                const tables = Object.keys(tabs);
                container.innerHTML = '';

                if (tables.length === 0) {
                    container.innerHTML = '<div class="empty-msg">Nenhuma conta aberta no momento.</div>';
                    return;
                }

                tables.forEach(t => {
                    const total = tabs[t].reduce((acc, i) => acc + (i.price * i.qty), 0);
                    
                    const html = `
                        <div class="card">
                            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                                <h2 style="font-size:1.5rem">Mesa ${t}</h2>
                                <span style="font-size:0.8rem; background:rgba(46, 204, 113, 0.1); color:var(--success); padding:4px 8px; border-radius:4px;">Aberta</span>
                            </div>
                            <div style="font-size:2rem; font-weight:700; color:var(--text-main); margin-bottom:20px;">
                                R$ ${total.toFixed(2)}
                            </div>
                            <button class="btn btn-primary" onclick="Modal.open('${t}')">Ver Detalhes</button>
                        </div>
                    `;
                    container.innerHTML += html;
                });
            }
        };

        // --- M√ìDULO MODAL & PAGAMENTO ---
        const Modal = {
            activeTable: null,
            open: (table) => {
                Modal.activeTable = table;
                const tabs = DB.getObj('restaurantTabs');
                const items = tabs[table];
                const content = document.getElementById('modal-content');
                
                let total = 0;
                content.innerHTML = '';

                items.forEach(i => {
                    total += i.price * i.qty;
                    content.innerHTML += `
                        <div class="bill-row">
                            <div>
                                <strong>${i.qty}x ${i.name}</strong><br>
                                <small style="color:var(--text-muted)">Gar√ßom: ${i.waiter || 'N/A'}</small>
                            </div>
                            <div>R$ ${(i.price * i.qty).toFixed(2)}</div>
                        </div>
                    `;
                });

                document.getElementById('modal-total-value').innerText = `R$ ${total.toFixed(2)}`;
                document.getElementById('modal').classList.remove('hidden');
            },
            close: () => {
                document.getElementById('modal').classList.add('hidden');
                Modal.activeTable = null;
            },
            pay: () => {
                if(!confirm(`Fechar conta da Mesa ${Modal.activeTable}?`)) return;

                const table = Modal.activeTable;
                const tabs = DB.getObj('restaurantTabs');
                const items = tabs[table];
                
                // 1. Salvar no Hist√≥rico Financeiro
                const history = DB.get('restaurantSalesHistory');
                items.forEach(item => {
                    history.push({
                        waiter: item.waiter || 'Caixa',
                        amount: item.price * item.qty,
                        item: item.name,
                        time: new Date().toLocaleTimeString()
                    });
                });
                DB.set('restaurantSalesHistory', history);

                // 2. Limpar Mesa
                delete tabs[table];
                DB.set('restaurantTabs', tabs);

                Modal.close();
                Tables.render(); // Atualiza tela
            }
        };

        // --- M√ìDULO FINANCEIRO ---
        const Finance = {
            render: () => {
                const history = DB.get('restaurantSalesHistory');
                const container = document.getElementById('finance-grid');
                
                // Agrupar vendas por gar√ßom
                const sales = {};
                let grandTotal = 0;

                history.forEach(entry => {
                    if(!sales[entry.waiter]) sales[entry.waiter] = 0;
                    sales[entry.waiter] += entry.amount;
                    grandTotal += entry.amount;
                });

                document.getElementById('finance-total').innerText = `R$ ${grandTotal.toFixed(2).replace('.', ',')}`;
                container.innerHTML = '';

                if (Object.keys(sales).length === 0) {
                    container.innerHTML = '<div class="empty-msg">Nenhuma venda registrada hoje.</div>';
                    return;
                }

                // Ordenar do maior para o menor
                Object.entries(sales)
                    .sort(([,a], [,b]) => b - a)
                    .forEach(([waiter, amount]) => {
                        const html = `
                            <div class="card card-stat">
                                <div>
                                    <div style="font-size:1.1rem; font-weight:bold; margin-bottom:5px;">${waiter}</div>
                                    <div class="stat-label">Vendas Totais</div>
                                </div>
                                <div class="stat-value">R$ ${amount.toFixed(2)}</div>
                            </div>
                        `;
                        container.innerHTML += html;
                    });
            },
            clear: () => {
                if(confirm('Tem certeza? Isso apagar√° o relat√≥rio de hoje.')) {
                    localStorage.removeItem('restaurantSalesHistory');
                    Finance.render();
                }
            }
        };

        // --- INICIALIZA√á√ÉO ---
        // Atualiza a cozinha automaticamente a cada 5s
        setInterval(() => {
            const kitchenView = document.getElementById('view-kitchen');
            if (!kitchenView.classList.contains('hidden')) Kitchen.render();
        }, 5000);

        // Carrega a primeira tela
        Kitchen.render();

    </script>
</body>
</html>
